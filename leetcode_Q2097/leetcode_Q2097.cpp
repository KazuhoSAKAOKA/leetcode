// leetcode_Q2097.cpp : このファイルには 'main' 関数が含まれています。プログラム実行の開始と終了がそこで行われます。
//

#include <iostream>
#include <vector>
#include <map>
#include <numeric>

#include "./../utility/leetcode_testcase_helper.h"

using namespace std;

class Solution {
public:

    static void dfs(map<int, vector<int>>& start_map, int u, vector<int>& trail) {
        auto& list = start_map[u];
        while (!list.empty()) {
            int dest = list.back();
            list.pop_back();
            dfs(start_map, dest, trail);
        }
        trail.emplace_back(u);
    }
    static int select_start(const map<int, int>& edges_in, map<int,int>& edges_out) {
        for (auto&& [k, out_count] : edges_out) {
            const auto it = edges_in.find(k);
            const auto in_count = it == end(edges_in) ? 0 : it->second;
            if (in_count < out_count) {
                return k;
            }
        }
        return (cbegin(edges_in))->first;
    }
    vector<vector<int>> validArrangement(vector<vector<int>>& pairs) {
        map<int, vector<int>> graph;
        map<int, int> edges_in;
        map<int, int> edges_out;
        for (auto&& pair : pairs) {
            const auto start_v = pair.front();
            const auto end_v = pair.back();
            graph[start_v].emplace_back(end_v);
            edges_in[end_v]++;
            edges_out[start_v]++;
        }
        const auto first = select_start(edges_in, edges_out);
        vector<int> trail;
        dfs(graph, first, trail);
        vector<vector<int>> ans;
        ans.reserve(size(pairs));
        for (int i = size(trail) - 2; i >= 0; i--) {
            ans.emplace_back(vector<int>{ trail[i + 1], trail[i] });
        }
        return ans;
    }
};

void test(vector<vector<int>>&& pairs) {
    output_matrix(Solution().validArrangement(pairs));
}
const string TEST_CASE = "[[1495,9093],[5273,6730],[1614,5819],[9238,5699],[1835,1570],[2047,5126],[6888,3251],[263,4204],[9325,5699],[1938,8009],[2188,9825],[6877,1139],[7866,4016],[3599,6885],[4211,4207],[7844,5491],[8351,9795],[4207,6632],[8809,396],[7783,4974],[983,8522],[222,8351],[5356,9729],[7951,5180],[8759,225],[9729,1829],[3572,5075],[3288,1160],[7642,7126],[3236,4185],[1733,7701],[6477,6097],[6920,3223],[6730,263],[7951,912],[5589,6920],[526,2188],[5400,8756],[1204,1160],[7245,1419],[8998,5068],[1204,5290],[5819,4440],[6735,3572],[976,4885],[692,3664],[1139,6632],[1938,8835],[526,5633],[7784,7866],[4116,3562],[5068,7642],[1675,4204],[6737,6950],[396,4171],[6658,7783],[4431,3664],[6632,2457],[7783,1614],[4688,9780],[9325,6435],[5072,6735],[8908,1882],[5699,7245],[8535,6649],[3649,3263],[8692,3330],[8682,722],[4440,6877],[4116,6258],[1835,6737],[7708,4431],[8835,222],[4185,4204],[5457,8692],[462,4230],[225,5092],[6950,3288],[8559,7331],[5068,222],[8652,5699],[9982,456],[4701,4204],[58,2380],[3026,4621],[4621,2710],[3562,4016],[6048,6658],[8908,6435],[263,8522],[8682,6950],[4010,7218],[5356,3235],[5061,6295],[2188,5400],[2457,5796],[6435,3426],[6402,2188],[6258,222],[8009,4701],[4977,8692],[5699,5778],[7701,5400],[885,4030],[7866,8379],[3223,9081],[9081,6783],[3251,5100],[5778,8682],[8692,1771],[6071,8692],[8597,526],[4204,6877],[3958,526],[6649,5457],[2536,9238],[8155,2399],[1570,9982],[4959,692],[6477,2181],[2687,6632],[6258,462],[8998,5356],[1796,8805],[4974,1771],[9795,9756],[6915,5092],[5317,7326],[3798,6258],[3242,8587],[945,8355],[3166,2710],[7245,9115],[8545,4293],[4621,2782],[2012,4945],[5213,5457],[8727,2851],[2687,6318],[3978,5297],[2159,1422],[9308,1343],[6920,6596],[1882,2647],[1113,8116],[4171,3556],[6632,9780],[5699,7866],[4185,9611],[2159,9081],[9780,874],[7245,4701],[6097,4185],[4885,8692],[4010,9982],[6477,6463],[4352,4293],[4959,1113],[7286,5796],[5946,4786],[1614,7954],[2710,9123],[6632,5796],[2181,1614],[9756,9115],[3664,6048],[3288,6477],[4016,8587],[5758,3288],[3330,7708],[7453,8009],[7063,7134],[8652,5083],[5356,8805],[7804,6658],[9115,3242],[3798,8535],[6649,5778],[4204,7245],[1282,5317],[6176,5501],[6897,8652],[2710,2633],[5796,5778],[1495,6737],[6737,9611],[4786,1835],[5457,8119],[6048,1204],[7804,5285],[4725,722],[6477,3166],[3798,8908],[1343,4211],[722,4885],[5100,3989],[8535,9123],[6318,1204],[9729,1950],[6606,3164],[3235,5290],[6596,3599],[945,456],[8759,6967],[1950,3562],[3426,1938],[2944,7804],[9081,5356],[6433,6110],[8522,6658],[3330,389],[4208,5072],[4336,3599],[1160,4781],[3166,3664],[2188,1221],[6735,3562],[7140,2687],[456,6318],[3263,6957],[5068,1771],[6377,874],[7218,4207],[6377,6258],[6730,7331],[8355,7920],[5075,8351],[8559,6538],[6783,8597],[222,3026],[7326,1675],[6295,6897],[4945,9048],[4786,3649],[6318,7063],[7331,4010],[5222,7675],[7134,4942],[1343,6735],[6538,5356],[8535,3859],[3832,8545],[3235,4211],[6433,6950],[6658,1459],[6649,9990],[9048,7920],[1299,8522],[8597,6658],[8835,7642],[4211,7894],[9611,3499],[7388,3664],[7326,5072],[9081,3164],[4977,3751],[222,6097],[9123,4207],[6097,6258],[1221,2710],[477,4010],[8587,3915],[912,5037],[9990,4725],[9081,6097],[6402,6377],[5290,8652],[4781,8726],[389,3223],[4781,5501],[8342,7820],[1419,8145],[729,6071],[2710,6295],[6783,6920],[3263,5819],[7845,6477],[6596,1950],[722,4974],[4688,4230],[1221,3989],[1664,1139],[8351,4688],[389,8535],[4010,8355],[4974,3958],[8756,7326],[2399,1459],[8145,222],[3562,5222],[2521,4110],[1221,6235],[3164,8756],[3164,263],[9780,2188],[4942,945],[6435,3751],[3242,6433],[1664,2944],[4230,4352],[8379,8998],[6441,6783],[1160,2159],[8805,6295],[6097,7804],[912,5061],[3958,5222],[9611,1422],[6649,6730],[5126,1664],[6013,9048],[1674,7951],[3664,8692],[7783,1938],[1449,951],[7772,5796],[3164,6538],[1113,8998],[1299,1614],[6538,8545],[1139,3330],[4446,2181],[1459,4977],[1139,6258],[6463,2047],[6046,9308],[3223,1419],[9123,6433],[3026,9581],[4621,8379],[456,7866],[2457,6463],[2047,9990],[6674,9780],[5037,5725],[3572,3649],[6950,477],[8587,9325],[5061,5037],[1829,2047],[6920,3166],[3672,4208],[9115,4786],[7140,2896],[9308,5068],[874,7297],[2457,8597],[5796,4977],[9196,1113],[8116,7140],[393,5819],[3288,8597],[7331,6441],[7140,8682],[8145,2687],[9729,1570],[885,6632],[1771,8379],[1139,389],[9780,6649],[222,9196],[8522,7245],[4701,1160],[885,6402],[8597,2110],[8692,9048],[6258,8908],[2647,8727],[6258,1299],[1221,6435],[5778,4725],[9982,8145],[8119,6377],[5297,6295],[225,1674],[1570,1449],[5796,9238],[3242,6950],[6110,6013],[6885,6013],[3599,6176],[5222,6317],[3915,5589],[4293,4116],[4781,7675],[2633,4185],[5092,1204],[4446,7140],[1771,4781],[3330,3235],[6317,885],[4293,3166],[7954,2836],[874,1664],[6317,4725],[3223,2159],[8727,4211],[8682,3958],[7437,2399],[6013,4207],[1419,9756],[7218,7157],[4701,8759],[1771,3251],[389,3958],[983,6596],[4293,8535],[7820,3242],[3426,222],[8545,7218],[8145,8355],[5222,2605],[2647,6920],[4204,6318],[9367,6674],[7675,6915],[4211,9780],[6071,1545],[7866,5100],[3499,5589],[3280,2687],[9081,3236],[6377,976],[4701,2687],[526,6477],[5589,6317],[7920,7951],[3251,3798],[526,945],[8307,7845],[1160,4959],[3751,4352],[7246,983],[8116,1495],[8726,8998],[1113,4977],[1938,456],[6885,7140],[2647,1221],[8119,6735],[8155,9581],[6632,2647],[9756,7783],[9780,9081],[3556,750],[462,7286],[4885,2536],[4110,1113],[4230,5531],[3915,4211],[1545,4446],[9093,8559],[6463,222],[3649,3978],[1495,7783],[3859,4431],[1422,6632],[222,6441],[912,3556],[2399,7954],[2605,6441],[6295,9115],[3280,9729],[2380,1796],[7920,1664],[1204,9196],[4352,692],[7642,9825],[3958,2468],[6295,8119],[5531,7453],[9115,1139],[6606,722],[3562,2457],[8726,3223],[8652,4781],[5100,8998],[8379,3026],[6110,1570],[4211,7951],[3166,9308],[6920,8559],[7845,1221],[3223,6596],[5072,1785],[5725,6377],[5531,2633],[5180,8759],[2647,9081],[9825,983],[8998,6737],[5325,3832],[8119,6877],[7675,3280],[3859,9990],[3223,8307],[2633,7845],[6632,6377],[1221,5758],[222,8116],[6441,4701],[8487,6479],[5273,3242],[8522,2521],[5589,3223],[6950,3235],[3556,6957],[1570,462],[6877,7245],[6658,1139],[6877,8908],[2181,5946],[4207,9238],[8726,2687],[6479,5222],[4204,912],[6957,729],[722,1495],[6235,3859],[1495,6649],[3664,3280],[926,526],[4185,225],[8379,6477],[6957,1495],[7951,389],[5213,6606],[5297,4116],[2159,4446],[4725,9196],[2633,8809],[1735,3426],[3235,3288],[1664,6920],[526,5589],[1785,926],[6596,3164],[3915,6885],[4030,526],[9238,9729],[5758,6046],[7140,8652],[5725,5213],[5819,3798],[4171,3460],[8116,7326],[8908,4688],[4431,4293],[5633,8119],[3649,8726],[7297,5758],[6658,1950],[8756,9982],[2687,2647],[9093,7920],[8355,8522],[5501,2457],[4725,526],[8692,8145],[1950,6013],[9196,3280],[4207,8155],[5037,1221],[8009,8835],[6435,222],[9990,2159],[5796,6596],[9581,4452],[5400,8155],[7388,9081],[5083,5273],[9238,4621],[1204,7388],[9825,58],[7920,1735],[6735,3649],[8998,7388],[1614,8727],[9048,3798],[6318,4701],[6596,926],[477,1882],[5819,4171],[6258,6632],[7326,1495],[5092,5213],[3989,8692],[9990,5297],[3026,6402],[4452,912],[9581,6606],[6967,8116],[5633,5457],[5290,7784],[3989,3263],[2851,2633],[6377,9611],[5778,7140],[5285,2647],[7954,1221],[4977,7246],[8692,885],[1422,7286],[4207,1204],[8692,3572],[692,2012],[6596,3223],[2782,9093],[1459,349],[6463,4452],[3280,5068],[8908,4446],[2896,7437],[3664,4010],[6735,8682],[5501,5531],[750,5633],[2110,8487],[349,393],[6013,4959],[926,3798],[4016,6071],[3751,1282],[8805,1343],[3798,5273],[9196,4621],[7245,1835],[4452,6649],[1221,8559],[8726,6596],[1882,8726],[2836,1733],[9982,3026],[2687,8908],[8559,6110],[2468,7844],[7157,9367],[6632,5061],[3562,8726],[7894,477],[7286,6888],[1950,6463],[2687,3330],[4446,3915],[456,5325],[222,3562],[3460,3672],[7126,4336],[9611,5725],[5457,1221],[6950,6048],[5491,8342],[8355,7772],[6295,9325],[951,3915],[8522,6735],[9048,1299],[6441,1938]]";
int main()
{
    //test(get_matrix_int(TEST_CASE));

    test(get_matrix_int("[[5,1],[4,5],[11,9],[9,4]]"));
    test(get_matrix_int("[[1,3],[3,2],[2,1]]"));
    test(get_matrix_int("[[1,2],[1,3],[2,1]]"));

    return 0;
}
